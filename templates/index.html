<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Analysis</title>
</head>
<body>
    <h1>Data Analysis</h1>
    
    <!-- Form to select analysis type and column -->
    <form id="analysis-form">
        <label for="analysis-type">Select Analysis Type:</label>
        <select id="analysis-type" name="analysis-type">
            <option value="summary">Summary Statistics</option>
            <option value="scatterplot">Scatterplot</option>
        </select>
        
        <label for="column">Select a column:</label>
        <select id="column" name="column">
            <!-- This will be populated dynamically with column names -->
        </select>
        
        <button type="submit">Analyze</button>
    </form>

    <!-- Where the summary statistics or scatterplot will be displayed -->
    <div id="analysis-results"></div>

    <!-- Include the JavaScript file -->
    <script>
        window.onload = function() {
            // Get column names from the Flask backend and populate the dropdown
            const columns = {{ columns | tojson }};  // This is passed from Flask to the frontend

            const columnSelect = document.getElementById('column');
            
            // Create option elements for each column and add them to the dropdown
            columns.forEach(function(column) {
                const option = document.createElement('option');
                option.value = column;
                option.textContent = column;
                columnSelect.appendChild(option);
            });
        };

        document.getElementById('analysis-form').addEventListener('submit', function(event) {
            event.preventDefault();  // Prevent the default form submission behavior

            const analysisType = document.getElementById('analysis-type').value;
            const column = document.getElementById('column').value;  // Get the selected column name

            // Prepare the request data as an object
            const requestData = {
                analysis_type: analysisType,
                column: column
            };

            // Send the POST request to the Flask server
            fetch('/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)  // Convert the request data to JSON format
            })
            .then(response => response.json())  // Parse the response as JSON
            .then(data => {
                if (data.error) {
                    // If there is an error in the response, display the error message
                    console.error('Error:', data.error);
                    alert(data.error);
                } else {
                    // Display results based on analysis type
                    let resultDiv = document.getElementById('analysis-results');
                    resultDiv.innerHTML = '';  // Clear previous results

                    if (analysisType === 'summary') {
                        // Display summary statistics
                        for (let stat in data) {
                            resultDiv.innerHTML += `<p><strong>${stat}:</strong> ${data[stat]}</p>`;
                        }
                    } else if (analysisType === 'scatterplot') {
                        // You can modify this to render a scatterplot
                        resultDiv.innerHTML = '<p>Scatterplot will be rendered here.</p>';
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('There was an error processing your request.');
            });
        });
    </script>
</body>
</html>
